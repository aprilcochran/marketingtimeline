<script>
  function format(d) {
    return d.toLocaleDateString(undefined, {
      month: 'short', day: 'numeric', year: 'numeric'
    });
  }

  function addDays(date, days) {
    const d = new Date(date);
    d.setDate(d.getDate() + days);
    return d;
  }

  // Evenly spaced N dates from startOffset -> endOffset (both "days before event")
  // Example: N=3, start=30, end=10 => [30,20,10] days before
  function evenlySpacedOffsets(count, startBefore, endBefore) {
    if (count <= 1) return [startBefore];
    const span = startBefore - endBefore; // e.g., 30-10 = 20
    const step = span / (count - 1);      // e.g., 20/2 = 10
    const offsets = [];
    for (let i = 0; i < count; i++) {
      offsets.push(Math.round(startBefore - step * i));
    }
    // Ensure first/last are exact
    offsets[0] = startBefore;
    offsets[offsets.length - 1] = endBefore;

    // Ensure uniqueness if rounding ever collides (rare but safe)
    const uniq = [...new Set(offsets)];
    while (uniq.length < count) {
      // add 1 day adjustments if needed
      const last = uniq[uniq.length - 1];
      uniq.push(last - 1);
    }
    return uniq;
  }

  function generate() {
    const input = document.getElementById("eventDate").value;
    if (!input) return alert("Please select a date");

    // local noon avoids timezone weirdness
    const eventDate = new Date(input + "T12:00:00");

    const list = document.getElementById("output");
    list.innerHTML = "";

    const d90 = addDays(eventDate, -90);

    // Weekly emails window: 60 → 45 days before
    const weeklyStart = addDays(eventDate, -60);
    const weeklyEnd = addDays(eventDate, -45);

    // Social posts: 3 posts evenly spaced from 30 → 10 days before
    const socialOffsets = evenlySpacedOffsets(3, 30, 10);
    const socialDates = socialOffsets
      .map(off => format(addDays(eventDate, -off)))
      .join(", ");

    // Push notifications: 30 days before AND 7 days before
    const pushDates = [30, 7]
      .map(off => format(addDays(eventDate, -off)))
      .join(", ");

    // Text message: 14 days before
    const textDate = format(addDays(eventDate, -14));

    const items = [
      ["Create Marketing Assets", format(d90)],
      ["Create MembersFirst Event", format(d90)],
      ["Begin including in weekly emails", `${format(weeklyStart)} – ${format(weeklyEnd)}`],
      ["Schedule three social media posts", socialDates],
      ["Send push notifications", pushDates],
      ["Send a text message", textDate]
    ];

    items.forEach(i => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${i[0]}:</strong> ${i[1]}`;
      list.appendChild(li);
    });

    document.getElementById("results").style.display = "block";
  }
</script>
